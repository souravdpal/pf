<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blog · Post</title>
      <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0b0f17;
      --card: rgba(255,255,255,0.07);
      --muted: #98a2b3;
      --text: #e6e8ee;
      --accent: #a78bfa; /* cute lilac */
      --accent2: #22d3ee; /* cyan */
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f7f7fb; --card:#ffffffcc; --text:#1f2937; --muted:#4b5563; }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 800px at 10% 0%, #101626 0%, var(--bg) 50%),
                           radial-gradient(1200px 800px at 90% 0%, #0e1a2b 0%, var(--bg) 50%);
      color:var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji', 'Segoe UI Symbol';
      line-height:1.6;
    }
    .container{max-width:980px; margin:0 auto; padding:24px;}
    .card{
      background: var(--card);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 24px; padding: 28px; box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      animation: floatIn .5s ease-out both;
    }
    @keyframes floatIn{ from{opacity:0; transform: translateY(8px) scale(.98)} to{opacity:1; transform:none} }

    .title{
      font-family: 'Space Grotesk', Inter, system-ui;
      font-size: clamp(28px, 4vw, 48px);
      line-height:1.1; margin: 0 0 10px;
      letter-spacing: -0.02em;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .meta{
      display:flex; gap:14px; align-items:center; color: var(--muted); font-size: 14px; margin-bottom: 18px;
    }
    .chip{border:1px dashed rgba(255,255,255,.25); padding:4px 10px; border-radius:999px}
    .hero{ position:relative; overflow:hidden; border-radius:18px; margin: 14px 0 22px; }
    .hero img{ width:100%; height:auto; display:block; object-fit:cover }
    .content{ font-size: 18px; color: var(--text); }

    /* Quill HTML resets (common tags) */
    .content h1,.content h2,.content h3{ font-family: 'Space Grotesk', Inter, system-ui; margin: 1.2em 0 .6em }
    .content h1{ font-size: clamp(26px,3vw,36px) }
    .content h2{ font-size: clamp(22px,2.5vw,28px) }
    .content h3{ font-size: clamp(19px,2vw,24px) }
    .content p{ margin: .9em 0 }
    .content ul, .content ol{ margin: .8em 0 .8em 1.25em }
    .content blockquote{ margin:1.2em 0; padding: 12px 14px; border-left: 3px solid var(--accent); background: rgba(255,255,255,.05); border-radius: 10px }
    .content pre{ background: #0f172a; color:#e5e7eb; padding:14px; border-radius:12px; overflow:auto; font-size: 14px }
    .content code{ background: rgba(0,0,0,.35); padding:2px 6px; border-radius:6px; }
    .content a{ color: var(--accent2); text-decoration: none; border-bottom: 1px dotted currentColor }

    .skeleton{ animation: pulse 1.2s ease-in-out infinite; background: linear-gradient(90deg, rgba(255,255,255,.08), rgba(255,255,255,.18), rgba(255,255,255,.08)); background-size: 200% 100% }
    @keyframes pulse{ 0%{background-position:0% 0} 100%{background-position:-200% 0} }

    .footer{ color: var(--muted); font-size: 13px; margin-top: 32px; display:flex; justify-content: space-between; align-items:center }
    .btn{ display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.2); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.06)); color:var(--text); text-decoration:none }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 30px rgba(0,0,0,.25) }
  </style>
  <!-- Sanitize Quill HTML safely -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js" defer></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1 id="title" class="title skeleton" style="min-height:2.4em"></h1>
      <div id="meta" class="meta" style="visibility:hidden">
        <span id="date" class="chip"></span>
        <span id="reading" class="chip"></span>
        <span id="idchip" class="chip"></span>
      </div>
      <div id="hero" class="hero" style="display:none">
        <img id="heroImg" alt="Blog cover" loading="lazy" />
      </div>
      <article id="content" class="content"></article>
      <div class="footer">
        <a class="btn" id="backBtn" href="/">← Back</a>
        <a class="btn" id="openApi" target="_blank" rel="noopener">View JSON</a>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const qs = new URLSearchParams(location.search);
      const id = qs.get('id');
      const titleEl = document.getElementById('title');
      const metaEl  = document.getElementById('meta');
      const dateEl  = document.getElementById('date');
      const readEl  = document.getElementById('reading');
      const idEl    = document.getElementById('idchip');
      const contentEl = document.getElementById('content');
      const heroWrap = document.getElementById('hero');
      const heroImg  = document.getElementById('heroImg');
      const openApi  = document.getElementById('openApi');

      if(!id){
        titleEl.classList.remove('skeleton');
        titleEl.textContent = 'Missing ?id=... in URL';
        contentEl.innerHTML = '<p>Please open this page like <code>/blog.html?id=POST_ID</code>.</p>';
        return;
      }

      const apiUrl = `/blog/${encodeURIComponent(id)}`;
      openApi.href = apiUrl;

      fetch(apiUrl)
        .then(r => {
          if(!r.ok) throw new Error('Failed to fetch post');
          return r.json();
        })
        .then(data => {
          // Title
          titleEl.classList.remove('skeleton');
          titleEl.textContent = data.title || 'Untitled';

          // Meta
          const date = data.createdAt ? new Date(data.createdAt) : null;
          dateEl.textContent = date ? `Published · ${date.toLocaleString([], {year:'numeric', month:'short', day:'2-digit'})}` : 'Draft';
          idEl.textContent = `id · ${data._id || 'unknown'}`;
          readEl.textContent = `${estimateReadMins(data.content)} min read`;
          metaEl.style.visibility = 'visible';

          // Hero image
          if (data.image && data.image !== 'null' && String(data.image).trim() !== ''){
            heroImg.src = data.image;
            heroWrap.style.display = 'block';
          }

          // Content (Quill HTML) — sanitize for safety
          const clean = DOMPurify.sanitize(data.content || '', { USE_PROFILES: { html: true } });
          contentEl.innerHTML = clean;
        })
        .catch(err => {
          titleEl.classList.remove('skeleton');
          titleEl.textContent = 'Post not found';
          contentEl.innerHTML = `<p style="color:#fca5a5">${err.message}</p>`;
        });

      function estimateReadMins(html){
        const tmp = document.createElement('div');
        tmp.innerHTML = html || '';
        const text = tmp.textContent || tmp.innerText || '';
        const words = text.trim().split(/\s+/).filter(Boolean).length;
        const mins = Math.max(1, Math.round(words / 200));
        return mins;
      }
    })();
  </script>
</body>
</html>
